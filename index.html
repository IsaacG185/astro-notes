<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AstroNotes</title>
<style>
/* ===== General Styles ===== */
body { font-family: Arial; max-width: 700px; margin:auto; padding:20px; line-height:1.6; background:#6a0dad; color:white; }
input, select, button { padding:8px; margin:5px 0; width:100%; border-radius:4px; border:none; box-sizing:border-box; }
button { font-size:16px; font-weight:bold; background:#4CAF50; color:white; cursor:pointer; }
button:hover { background:#45a049; }
h1,h2 { margin-top:30px; }
pre { white-space: pre-wrap; }

/* Separation bars */
hr { border: 1px solid #fff; margin:40px 0; }
</style>
</head>
<body>

<!-- ================= Constant Finder Tool ================= -->
<h1>Constant Finder</h1>
<label for="constantSearch">Search for a constant:</label>
<input type="text" id="constantSearch" placeholder="Type constant name, i.e. Planck constant, Solar radius..." oninput="searchConstants()">
<pre id="constantResult"></pre>

<hr>

<!-- ================= Astro Unit Converter ================= -->
<h1>Astro Unit Converter</h1>
<label for="inputUnit">From:</label>
<select id="inputUnit">
  <optgroup label="Energy"><option value="eV">eV</option><option value="keV">keV</option></optgroup>
  <optgroup label="Wavelength"><option value="angstrom">Å</option><option value="nm">nm</option></optgroup>
</select>
<label for="outputUnit">To:</label>
<select id="outputUnit">
  <optgroup label="Energy"><option value="eV">eV</option><option value="keV">keV</option></optgroup>
  <optgroup label="Wavelength"><option value="angstrom">Å</option><option value="nm">nm</option></optgroup>
</select>
<label for="inputValue">Value:</label>
<input type="number" id="inputValue" step="any">
<button onclick="convert()">Convert</button>
<h2 id="result"></h2>

<hr>

<!-- ================= Emission Line Finder ================= -->
<h1>Emission Line Finder</h1>
<label for="lineUnit">Input type:</label>
<select id="lineUnit">
  <option value="energy">Energy (keV)</option>
  <option value="wavelength">Wavelength (Å)</option>
</select>
<label for="lineValue">Value:</label>
<input type="number" id="lineValue" step="any">
<label for="redshift">Redshift (z):</label>
<input type="number" id="redshift" step="any" value="0">
<button onclick="findLines()">Find Emission Lines</button>
<pre id="lineResult"></pre>

<!-- ================= Scripts ================= -->
<script src="constants.js"></script>
<script src="emissionLines.js"></script>


<!-- Functions for all tools -->
<script>
// ----------------- Constant Finder Functions -----------------
function stripHtml(html) {
  let div = document.createElement("div");
  div.innerHTML = html;
  return div.textContent || div.innerText || "";
}

function searchConstants() {
  const term = document.getElementById("constantSearch").value.toLowerCase();
  const resultArea = document.getElementById("constantResult");

  if (term.trim() === "") {
    resultArea.textContent = "";
    return;
  }

  const results = Object.values(window.constants).filter(c =>
    c.name.toLowerCase().includes(term) // search by plain name
  );

  if (results.length === 0) {
    resultArea.textContent = "No constants found.";
    return;
  }

  // Use displayName for HTML display
  resultArea.innerHTML = results.map(c => {
  const valuesStr = Object.entries(c.values)
    .map(([unit, val]) => `${val.toExponential()} ${unit}`)
    .join("<br>");
  
  return `<div style="font-size:1.3em; font-weight:bold;">${c.displayName}</div>
          <div>Definition: ${c.definition}</div>
          <div>Values:<br>${valuesStr}</div>`;
}).join("<hr style='border:1px solid white; margin:10px 0;'>");
  
}
// ----------------- Unit Converter -----------------
const hc_keV_A = window.constants.planck_constant_h.values["keV*s"] *
                window.constants.speed_of_light_c.values["Å*s^-1"];

function convert() {
  let value = parseFloat(document.getElementById('inputValue').value);
  let from = document.getElementById('inputUnit').value;
  let to = document.getElementById('outputUnit').value;
  let resultText = document.getElementById('result');

  if(isNaN(value) || value <= 0){
    resultText.textContent = "Please enter a valid positive number.";
    return;
  }

  // Convert input to Å first
  let angstromValue = from==="angstrom"?value:
                      from==="nm"?value*10:
                      from==="keV"?hc_keV_A/value:
                      (hc_keV_A*1000)/value;

  // Convert Å to desired output
  let outputValue = to==="angstrom"?angstromValue:
                    to==="nm"?angstromValue/10:
                    to==="keV"?hc_keV_A/angstromValue:
                    (hc_keV_A*1000)/angstromValue;

  resultText.textContent = `${value} ${from} = ${outputValue.toFixed(6)} ${to}`;
}

// ----------------- Emission Line Finder -----------------
function findLines(){
  let value = parseFloat(document.getElementById('lineValue').value);
  let unit = document.getElementById('lineUnit').value;
  let z = parseFloat(document.getElementById('redshift').value)||0;
  let resultText = document.getElementById('lineResult');

  if(isNaN(value)||value<=0){
    resultText.textContent="Please enter a valid positive number.";
    return;
  }

  let inputEnergy = unit==="energy"?value:hc_keV_A/value;
  let inputWavelength = unit==="wavelength"?value:hc_keV_A/value;
  let tolerance = 0.05;

  let matches = window.emissionLines.filter(line=>{
    let obsWavelength = line.wavelength*(1+z);
    let obsEnergy = line.energy/(1+z);
    return Math.abs((obsEnergy-inputEnergy)/inputEnergy)<tolerance ||
           Math.abs((obsWavelength-inputWavelength)/inputWavelength)<tolerance;
  });

  if(matches.length===0){
    resultText.textContent="No strong emission lines found near that value.";
  } else {
    resultText.textContent = matches.map(line=>{
      let obsWavelength = line.wavelength*(1+z);
      let obsEnergy = line.energy/(1+z);
      return `${line.name.padEnd(18)} Rest: ${line.energy.toFixed(3)} keV / ${line.wavelength.toFixed(2)} Å\nObserved (z=${z}): ${obsEnergy.toFixed(3)} keV / ${obsWavelength.toFixed(2)} Å`;
    }).join("\n\n");
  }
}
</script>
</body>
</html>
